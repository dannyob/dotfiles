##
# HISTORY
###
#
declare -x HISTFILE=/home/danny/Private/histfile
declare -x SAVEHIST=2048
declare -x HISTSIZE=2048
setopt INC_APPEND_HISTORY

GPG_TTY=$(tty)
export GPG_TTY

unset SSH_AGENT_PID
if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
    export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
fi

###
# GUIX
###

if [[ -d "$GUIX_PROFILE" ]]; then
    . $GUIX_PROFILE/etc/profile
fi

export GUIX_LOCPATH="$HOME/.guix-profile/lib/locale"

export SSL_CERT_DIR="$HOME/.guix-profile/etc/ssl/certs"
export SSL_CERT_FILE="$HOME/.guix-profile/etc/ssl/certs/ca-certificates.crt"
export GIT_SSL_CAINFO="$SSL_CERT_FILE"

export INFOPATH="/home/danny/.guix-profile/share/info${INFOPATH:+:}$INFOPATH"

export GUILE_LOAD_PATH="/home/danny/.guix-profile/share/guile/site/2.2${GUILE_LOAD_PATH:+:}$GUILE_LOAD_PATH"
export GUILE_LOAD_COMPILED_PATH="/home/danny/.guix-profile/lib/guile/2.2/site-ccache${GUILE_LOAD_COMPILED_PATH:+:}$GUILE_LOAD_COMPILED_PATH"

export ACLOCAL_PATH="/home/danny/.guix-profile/share/aclocal${ACLOCAL_PATH:+:}$ACLOCAL_PATH"
export PKG_CONFIG_PATH="/home/danny/.guix-profile/lib/pkgconfig${PKG_CONFIG_PATH:+:}$PKG_CONFIG_PATH"

pathadd /home/danny/.config/guix/current/bin
pathadd /home/danny/.guix-profile/bin

fpath=(~/.config/guix/current/share/zsh/site-functions/ $fpath)

###
# LOCAL FUNCTIONS
###

aptinstall() {
	local commit
	vared -c -p "Why are you installing $1? " commit
	if sudo apt-get install $1; then
        cat >>~/ChangeLog<<EOF
$(date -Imin)  $DEBFULLNAME  <$DEBEMAIL>

	* $commit

	% sudo apt-get install $1
EOF
	else
		echo "Not logged!"
	fi
}

guixinstall() {
	local commit
	vared -c -p "Why are you installing $1? " commit
	if guix package -i $1; then
        cat >>~/ChangeLog<<EOF

$(date -Imin)  $DEBFULLNAME  <$DEBEMAIL>

	* $commit

	% guix package -i $1
EOF
	else
		echo "Not logged!"
	fi
}

###
# ANTIGEN
###

source /usr/share/zsh-antigen/antigen.zsh
antigen bundle zsh-users/zsh-syntax-highlighting
antigen bundle twang817/zsh-fasd
antigen bundle zsh-users/zsh-history-substring-search
antigen apply

###
# FASD
###

eval "$(fasd --init auto)"
bindkey '^X^A' fasd-complete    # C-x C-a to do fasd-complete (files and directories)
bindkey '^X^F' fasd-complete-f  # C-x C-f to do fasd-complete-f (only files)
bindkey '^X^D' fasd-complete-d  # C-x C-d to do fasd-complete-d (only directories)
alias c='fasd_cd -d'
alias cc='fasd_cd -d -i'
alias v='f -e nvim' 

# zsh-history-substring-search
bindkey -M vicmd 'k' history-substring-search-up
bindkey -M vicmd 'j' history-substring-search-down
zmodload zsh/terminfo
bindkey "$terminfo[kcuu1]" history-substring-search-up
bindkey "$terminfo[kcud1]" history-substring-search-down
